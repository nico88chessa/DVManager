<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui">


<h:body>
    
<ui:composition template="/WEB-INF/layout/appLayout.xhtml">

    <ui:define name="content">

        <div id="divDBManagement">
        
            <div class="ui-g">
            
            
            
                <!-- qui visualizzo il pulsante per aggiungere una nuova macchina -->
                <div class="ui-g-12">
                    <h:form id="newMachineForm">
                        <p:commandButton id="inserisciMacchinaCB"
                            widgetVar="inserisciMacchinaCB"
                            value="Inserisci macchine"
                            icon="ui-icon-star"
                            actionListener="#{mainCtrl.clearNewMachineValues()}"
                            oncomplete="PF('inserisciMacchinaDlg').show()"
                            update=":newMachineForm:inserisciMacchinaDlg" />

                        <p:dialog id="inserisciMacchinaDlg"
                            widgetVar="inserisciMacchinaDlg"
                            header="Inserisci macchina" modal="true"
                            height="200" width="500" minHeight="200"
                            minWidth="400">

                            <div class="ui-g">

                                <div class="ui-g-6" style="">
                                    <p:outputLabel
                                        value="Nome macchina" />
                                </div>
                                <div class="ui-g-6">
                                    <p:inputMask id="nomeMacchinaIM"
                                        widgetVar="nomeMacchinaIM"
                                        slotChar=" "
                                        value="#{mainBean.newMachine.name}" />
                                </div>

                                <div class="ui-g-6">
                                    <p:outputLabel
                                        value="Indirizzo IP" />
                                </div>
                                <div class="ui-g-6">
                                    <p:inputMask id="ipIM"
                                        widgetVar="ipIM"
                                        mask="9?99.999.999.999"
                                        slotChar="0"
                                        value="#{mainBean.newMachine.ip}" />
                                </div>

                                <f:facet name="footer">
                                    <div class="ui-g-8" />

                                    <div class="ui-g-2">
                                        <p:commandButton
                                            id="confermaInserimentoCB"
                                            widgetVar="confermaInserimentoCB"
                                            value="Inserisci"
                                            onclick="PF('inserisciMacchinaDlg').hide()"
                                            actionListener="#{mainCtrl.addNewMachineToDB()}"
                                            update="globalGrow, :machineForm:machines" />
                                    </div>

                                    <div class="ui-g-2">
                                        <p:commandButton
                                            id="annullaInserimentoCB"
                                            widgetVar="annullaInserimentoCB"
                                            value="Annulla"
                                            onclick="PF('inserisciMacchinaDlg').hide()" />
                                    </div>

                                </f:facet>

                            </div>

                        </p:dialog>
                    </h:form> 
                </div>
                
                
            
                <!-- questa e' la tabella di visualizzazione dei dati -->
                <div class="ui-g-12">
                    
                    <div id="machinesDiv" class="ui-g">
                        <h:form id="startup">
                            <p:remoteCommand id="rcShowMachineList" actionListener="#{mainCtrl.init}"
                            update="globalGrow, machineForm" autoRun="#{empty mainBean.machines}" />
                        </h:form>
                        
                        <h:form id="machineForm">
                        
                            <!-- tabella valori -->
                            <p:dataTable id="machines" value="#{mainBean.machines}" var="item" editable="true">
                                <p:column headerText="Nome">
                                    <p:outputLabel value="#{item.name}" />
                                </p:column>
                                <p:column headerText="ID">
                                    <p:outputLabel value="#{item.id}" />
                                </p:column>
                                <p:column headerText="Indirizzo IP">
                                    <p:outputLabel value="#{item.ip}" />
                                </p:column>
                                <p:column headerText="Ultimo aggiornamento">
                                    <p:outputLabel value="#{item.lastUpdate eq null ? '-' : item.lastUpdate}" style="position: relative; left:50%" />
                                </p:column>
                                <p:column headerText="Elimina" style="width:10%" >
                                        <p:commandButton
                                            update="machineForm:deleteMachineDlg"
                                            icon="ui-icon-cancel"
                                            oncomplete="PF('deleteMachineDlg').show()"
                                            style="position: relative; left:40%" >
                                            <f:setPropertyActionListener
                                                value="#{item}"
                                                target="#{mainBean.selectedMachine}" />
                                        </p:commandButton>
                                    </p:column>
                                <p:column headerText="Ping test" style="width:10%" >
                                    <p:commandButton
                                        icon="ui-icon-ping"
                                        global="false"
                                        oncomplete="callIP()"
                                        style="position: relative; left:40%" >
                                        <f:setPropertyActionListener
                                            value="#{item}"
                                            target="#{mainBean.selectedMachine}" />
                                    </p:commandButton>
                                </p:column>
                            </p:dataTable>


                            <!-- finestra dialogo per cancellazione macchina -->
                            <p:dialog widgetVar="deleteMachineDlg"
                                id="deleteMachineDlg" modal="true"
                                width="500" height="200"
                                resizable="false"
                                rendered="#{not empty mainBean.selectedMachine}">

                                <div class="ui-g-12">
                                    <p:outputLabel
                                        value="Confermi di voler eliminare la macchina?" />
                                </div>

                                <div class="ui-g-6" style="">
                                    <p:outputLabel
                                        value="Nome macchina" />
                                </div>
                                <div class="ui-g-6">
                                    <p:inputMask id="nomeMacchinaIM"
                                        widgetVar="nomeMacchinaIM"
                                        slotChar=" " readonly="true"
                                        value="#{mainBean.selectedMachine.name}" />
                                </div>

                                <div class="ui-g-6">
                                    <p:outputLabel
                                        value="Indirizzo IP" />
                                </div>
                                <div class="ui-g-6">
                                    <p:inputMask id="ipIM"
                                        widgetVar="ipIM"
                                        mask="9?99.999.999.999"
                                        slotChar="0" readonly="true"
                                        value="#{mainBean.selectedMachine.ip}" />
                                </div>



                                <f:facet name="footer">
                                    <div class="ui-g-8" />

                                    <div class="ui-g-2">
                                        <p:commandButton
                                            id="confermaDeleteCB"
                                            widgetVar="confermaDeleteCB"
                                            value="Elimina"
                                            onclick="PF('deleteMachineDlg').hide()"
                                            actionListener="#{mainCtrl.deleteMachineFromDB()}"
                                            update="globalGrow, :machineForm:machines" />
                                    </div>

                                    <div class="ui-g-2">
                                        <p:commandButton
                                            id="annullaDeleteCB"
                                            widgetVar="annullaDeleteCB"
                                            value="Annulla"
                                            onclick="PF('deleteMachineDlg').hide()" />
                                    </div>
                                </f:facet>
                            </p:dialog>

                            <!-- finestra dialogo per comando di ping -->
                            <p:dialog id="ipDlg" widgetVar="ipDlg"
                                modal="true" resizable="true"
                                visible="false" width="540"
                                height="500">

                                <p:inputTextarea id="ipITA"
                                    widgetVar="ipITA"
                                    value="#{mainBean.ipCommandResult}"
                                    readonly="true"
                                    styleClass="ipItaStyle" />

                            </p:dialog>

                            <p:remoteCommand name="callIP" actionListener="#{mainCtrl.pingMachine}"
                                update="machineForm:ipDlg" oncomplete="PF('ipDlg').show()" />


                        </h:form>
                    
                    </div>

                </div>

                
            </div>
        
        </div>

    </ui:define>

</ui:composition>

</h:body>

</html>